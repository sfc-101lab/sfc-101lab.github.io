<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字符串好感度计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/pinyin@4.0.0/lib/umd/pinyin.js"></script>
    <script src="https://unpkg.com/wanakana@5.3.1/wanakana.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .rainbow-text {
            background: linear-gradient(90deg, #ef4444, #f97316, #eab308, #84cc16, #22c55e, #14b8a6, #06b6d4, #3b82f6, #8b5cf6, #d946ef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        .progress-bar-inner {
            transition: width 0.8s cubic-bezier(0.25, 0.1, 0.25, 1), background-color 0.8s ease;
        }
        /* -- 新增和修改的动画 -- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
            20%, 40%, 60%, 80% { transform: translateX(6px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }

        @keyframes rainbow-glow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .rainbow-100 {
            background: linear-gradient(270deg, #d946ef, #8b5cf6, #3b82f6, #06b6d4, #14b8a6, #22c55e, #84cc16, #eab308, #f97316, #ef4444);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow-glow 2s linear infinite;
        }

        /* 1. 页面加载时主容器的进入动画 */
        @keyframes initial-fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .container-fade-in { animation: initial-fade-in 0.7s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }

        /* 2. 结果百分比的“砰”弹出动画 */
        @keyframes pop-in {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .pop-in { animation: pop-in 0.5s cubic-bezier(0.25, 0.1, 0.25, 1) forwards; }
        
        /* 3. 进度条的辉光动画 */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 8px rgba(168, 85, 247, 0.3), 0 0 12px rgba(168, 85, 247, 0.2); }
            50% { box-shadow: 0 0 16px rgba(168, 85, 247, 0.7), 0 0 24px rgba(168, 85, 247, 0.5); }
        }
        .pulsing-glow { animation: pulse-glow 1.5s infinite ease-in-out; }

    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <!-- 增加了 container-fade-in class 来实现进入动画 -->
    <div class="w-full max-w-md mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 space-y-6 container-fade-in">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold rainbow-text">字符串好感度计算器</h1>
            <p class="text-gray-400 mt-2">输入一个字符串，看看“科学”的计算结果！</p>
            <p class="text-xs text-gray-500 mt-1">（纯属娱乐，请勿当真）</p>
        </div>

        <!-- Input Form -->
        <div class="space-y-4">
            <input type="text" id="nameInput" placeholder="输入任意字符串" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300">
            <!-- 增加了 active:scale-95 来实现按钮按压效果 -->
            <button id="calculateBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 transform hover:scale-105 active:scale-95 shadow-lg">
                <span id="btnText">开始计算</span>
                <span id="btnSpinner" class="hidden animate-spin">◐</span>
            </button>
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="hidden pt-6 space-y-4 text-center">
            <h2 class="text-xl font-semibold text-gray-300 fade-in-up">计算结果 for "<span id="resultName" class="font-bold text-purple-400"></span>"</h2>
            
            <div class="relative w-full h-8 bg-gray-700 rounded-full overflow-hidden border-2 border-gray-600">
                <div id="progressBar" class="progress-bar-inner h-full rounded-full" style="width: 0%;"></div>
                <span id="percentageText" class="absolute inset-0 flex items-center justify-center text-sm font-bold text-white opacity-0">0%</span>
            </div>

            <p id="resultMessage" class="text-lg font-medium text-gray-200 h-12 flex items-center justify-center"></p>
        </div>
    </div>

    <script>
        window.onload = function() {
            const nameInput = document.getElementById('nameInput');
            const calculateBtn = document.getElementById('calculateBtn');
            const btnText = document.getElementById('btnText');
            const btnSpinner = document.getElementById('btnSpinner');
            
            const resultSection = document.getElementById('resultSection');
            const resultName = document.getElementById('resultName');
            const progressBar = document.getElementById('progressBar');
            const percentageText = document.getElementById('percentageText');
            const resultMessage = document.getElementById('resultMessage');

            let typingInterval; // 用于控制打字机效果的计时器

            function normalizeName(name) {
                let processedName = name.trim().toLowerCase();
                
                if (/[\u4e00-\u9fa5]/.test(processedName)) {
                    processedName = pinyin.pinyin(processedName, { style: pinyin.STYLE_NORMAL }).flat().join('');
                } else if (wanakana.isJapanese(processedName)) {
                    processedName = wanakana.toRomaji(processedName);
                }
                
                const letters = processedName.replace(/[^a-z]/g, '');
                const numbers = processedName.replace(/[^0-9]/g, '');
                const specials = processedName.replace(/[a-z0-9]/g, '');

                return { letters, numbers, specials };
            }

            function getNumericValues(normalizedParts) {
                const letterValues = normalizedParts.letters.split('').map(char => char.charCodeAt(0) - 96);
                const numberSum = normalizedParts.numbers.split('').reduce((acc, digit) => acc + parseInt(digit, 10), 0);
                const specialSum = normalizedParts.specials.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                return { letterValues, numberSum, specialSum };
            }

            function matrixCalculation(values, originalName) {
                const { letterValues, numberSum, specialSum } = values;
                if (letterValues.length === 0 && numberSum === 0 && specialSum === 0) return 0;

                const letterSum = letterValues.reduce((acc, val) => acc + val, 0);
                const totalSum = letterSum + numberSum + specialSum;
                const magicConstant = originalName.length * 39;
                let hash = (letterValues.length > 0) ? (letterValues[0] * (letterValues[letterValues.length - 1] || 1)) : (numberSum * 13);
                hash += specialSum * 17;
                
                let result = (totalSum * magicConstant + hash) % 101;
                return result < 0 ? result + 101 : result;
            }

            function getResultMessage(percentage) {
                const messageTiers = {
                    0: [
                        "这串字符……建议直接格式化处理。",
                        "它存在的意义，大概就是提醒我什么叫‘反例’。",
                        "我宁愿面对一串乱码，也不想再看它一眼。",
                        "这种字符串，应该被写进《反模式大全》第一章。",
                        "抱歉，它连做我垃圾桶标签的资格都没有。"
                    ],
                    10: [
                        "勉强能认出是个字符串……仅此而已。",
                        "它像是被键盘随机砸出来的产物。",
                        "存在感比空气还稀薄。",
                        "如果字符串有生命，它一定在装死。",
                        "我对它的兴趣，还不如对一个分号。"
                    ],
                    20: [
                        "至少它没有语法错误……算是优点吧。",
                        "结构松散，毫无美感，但勉强能读。",
                        "像是一段被遗忘在角落的代码注释。",
                        "它让我想起了凌晨三点调试失败的日志。",
                        "能用，但用完建议洗手。"
                    ],
                    40: [
                        "嗯……还算规整，有点潜力。",
                        "虽然平平无奇，但至少不碍眼。",
                        "像是标准库里的默认示例字符串。",
                        "它可以胜任一个普通变量名。",
                        "中规中矩，没有惊喜，也没有惊吓。"
                    ],
                    60: [
                        "不错，结构清晰，读起来很顺。",
                        "这串字符让我想起了初恋——平淡但可靠。",
                        "适合放进文档示例里，不会丢人。",
                        "有节奏，有逻辑，值得一个赞。",
                        "我已经开始考虑把它设为默认值了。"
                    ],
                    75: [
                        "哇哦，这平衡感！像是精心雕琢过的艺术品。",
                        "它的字符分布让我心跳加速。",
                        "每一个字符都恰到好处，太舒服了！",
                        "我已经把它加入‘最喜欢的字符串’收藏夹。",
                        "这串字符，值得我为它写一首诗。"
                    ],
                    90: [
                        "天啊……这是我梦中才会出现的字符串！",
                        "它的美感让我怀疑自己是不是在做梦。",
                        "每一个字符都在发光，它简直是神迹！",
                        "我愿意为它重构整个项目架构。",
                        "这不是字符串，这是灵魂的共鸣！"
                    ],
                    100: [
                        "……（str同学已因过度感动而昏厥）",
                        "宇宙的终极答案，原来藏在这串字符里。",
                        "它完美得让我想跪下膜拜。",
                        "我已经决定，要把它的哈希值纹在手臂上。",
                        "这是我能想到的，最接近神的作品。"
                    ]
                };
                let selectedTier;
                if (percentage === 0) selectedTier = messageTiers[0];
                else if (percentage <= 10) selectedTier = messageTiers[10];
                else if (percentage <= 20) selectedTier = messageTiers[20];
                else if (percentage <= 40) selectedTier = messageTiers[40];
                else if (percentage <= 60) selectedTier = messageTiers[60];
                else if (percentage <= 75) selectedTier = messageTiers[75];
                else if (percentage <= 90) selectedTier = messageTiers[90];
                else selectedTier = messageTiers[100];
                const randomIndex = Math.floor(Math.random() * selectedTier.length);
                return selectedTier[randomIndex];
            }
            
            function getProgressBarColor(percentage) {
                const colors = [ { p: 0, color: '#3b82f6' }, { p: 25, color: '#22c55e' }, { p: 50, color: '#eab308' }, { p: 75, color: '#f97316' }, { p: 100, color: '#d946ef' } ];
                for (let i = 1; i < colors.length; i++) {
                    if (percentage <= colors[i].p) {
                        const p1 = colors[i-1].p, p2 = colors[i].p, c1 = colors[i-1].color, c2 = colors[i].color;
                        const factor = (p2 - p1 === 0) ? 1 : (percentage - p1) / (p2 - p1);
                        const r1 = parseInt(c1.substring(1,3),16), g1 = parseInt(c1.substring(3,5),16), b1 = parseInt(c1.substring(5,7),16);
                        const r2 = parseInt(c2.substring(1,3),16), g2 = parseInt(c2.substring(3,5),16), b2 = parseInt(c2.substring(5,7),16);
                        const r = Math.round(r1 + factor * (r2-r1)), g = Math.round(g1 + factor * (g2-g1)), b = Math.round(b1 + factor * (b2-b1));
                        return `rgb(${r},${g},${b})`;
                    }
                }
                return colors[colors.length - 1].color;
            }

            // 4. 新增的打字机效果函数
            function typeResultMessage(message) {
                clearInterval(typingInterval);
                resultMessage.textContent = '';
                let i = 0;
                typingInterval = setInterval(() => {
                    if (i < message.length) {
                        resultMessage.textContent += message.charAt(i);
                        i++;
                    } else {
                        clearInterval(typingInterval);
                    }
                }, 50); // 每个字 50 毫秒
            }

            function displayResult(name, percentage) {
                resultName.textContent = name;
                resultSection.classList.remove('hidden');
                
                // 重置样式
                percentageText.style.opacity = 0;
                resultMessage.textContent = '';
                percentageText.classList.remove('pop-in', 'rainbow-100');
                progressBar.classList.remove('pulsing-glow');
                
                setTimeout(() => progressBar.classList.add('pulsing-glow'), 100);

                let currentPercent = -1;
                const interval = setInterval(() => {
                    currentPercent++;
                    if (currentPercent >= percentage) {
                        clearInterval(interval);
                        currentPercent = percentage;
                        
                        percentageText.textContent = `${currentPercent}%`;
                        percentageText.style.opacity = 1;
                        percentageText.classList.add('pop-in'); // 应用弹出动画
                        
                        const finalMessage = getResultMessage(percentage);
                        typeResultMessage(finalMessage); // 调用打字机效果

                        if (currentPercent === 100) {
                            percentageText.classList.add('rainbow-100');
                        }
                        
                        setTimeout(() => progressBar.classList.remove('pulsing-glow'), 500);
                    }
                    progressBar.style.width = `${currentPercent}%`;
                    progressBar.style.backgroundColor = getProgressBarColor(currentPercent);
                    if(currentPercent !== -1) {
                       percentageText.textContent = `${currentPercent}%`;
                       percentageText.style.opacity = 1;
                    }
                }, 20);
            }

            function handleCalculation() {
                const originalName = nameInput.value;
                if (!originalName.trim()) {
                    nameInput.classList.add('shake');
                    setTimeout(() => nameInput.classList.remove('shake'), 500);
                    return;
                }
                btnText.classList.add('hidden');
                btnSpinner.classList.remove('hidden');
                calculateBtn.disabled = true;
                resultSection.classList.add('hidden');
                
                clearInterval(typingInterval); // 如果上次的打字机还在运行，则清除

                setTimeout(() => {
                    const normalizedParts = normalizeName(originalName);
                    const numericValues = getNumericValues(normalizedParts);
                    const finalPercentage = matrixCalculation(numericValues, originalName);
                    displayResult(originalName, finalPercentage);
                    btnText.classList.remove('hidden');
                    btnSpinner.classList.add('hidden');
                    calculateBtn.disabled = false;
                }, 800);
            }

            calculateBtn.addEventListener('click', handleCalculation);
            nameInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    handleCalculation();
                }
            });
        };
    </script>
</body>
</html>